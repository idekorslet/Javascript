<!DOCTYPE html>
<html lang="en">

<head>
    <title>Product Finder</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body style="background-color:rgba(152, 149, 160, 0.986);">
    <!-- <div class="spinner-border text-primary"></div> -->
    <div class="container mt-3">
        <h2>cariproduk.com</h2>
        <p>Temukan beberapa produk yang ingin kamu cari di toko/penjual yang sama dan di beberapa e-commerce sekaligus
            <br>
            sehingga dapat menghemat biaya ongkir, dan yang pasti menghemat waktu kalian dalam melakukan pencarian
        </p>
        <hr>

        <!-- <div class="d-flex flex-row border border-primary"> -->
        <div class="d-flex flex-row">
            <!-- menu pilih e-commerse -->
            <div class="col-sm-2" style="width: 170px;">
                <div class="card bg-light mb-2" style="max-width: 10rem;">
                    <div class="card-header" style="height: 30px; width: 160px;">
                        <h6>Pilih e-commerce</h6>
                    </div>
                    <div class="card-body" style="padding-top: 7px;">
                        <div class="form-check form-switch">                            
                            <input class="form-check-input" type="checkbox" role="switch" id="shopee_check" checked value="shopee" onchange="update_ecommerce_list(this)">
                            <label class="form-check-label" for="shopee_check">Shopee</label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="tokopedia_check" value="tokopedia" onchange="update_ecommerce_list(this)">
                            <label class="form-check-label" for="tokopedia_check">Tokopedia</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- menu input keyword -->
            <div class="col">

                <div class="card bg-light mb-2" style="max-width: 200rem;">
                    <div class="card-header" style="height: 30px;">
                        <h6>Produk yang dicari:</h6>
                    </div>

                    <div class="card-body ml-auto" style="padding-left: 0px; padding-top: 8px;">
                        <div class="container">
                            <div class="row">
                                <div class="col order-1">
                                    <input type="text" id="text_keyword1" class="pb-suggestion form-control" aria-label="search" value="" placeholder="Ketik nama produk 1">
                                </div>

                                <div class="col order-2" style="padding-left: 0px;">
                                    <input type="text" id="text_keyword2" class="pb-suggestion form-control" aria-label="search" value="" placeholder="Ketik nama produk 2">
                                </div>

                                <div class="col order-3" style="padding-left: 0px;">
                                    <input type="text" id="text_keyword3" class="pb-suggestion form-control" aria-label="search" value="" placeholder="Ketik nama produk 3">
                                </div>

                                <div class="col order-4" style="padding-left: 0px;">
                                    <input type="text" id="text_keyword4" class="pb-suggestion form-control" aria-label="search" value="" placeholder="Ketik nama produk 4">
                                </div>

                            </div>

                            <div class="row" style="height: 40px;">
                                <div class="col" style="padding-top: 10px; width: 400px;">
                                    <i><b>*Masukkan minimal 2 (dua) keyword</b></i>
                                </div>
                                <!-- <div class="col-12 col-sm-auto" id="loading" style="padding-top: 10px;"></div> -->
                                <div class="col" id="spin_loading" style="margin-top: 10px; margin-left: 80px;"></div>

                                <div class="col">
                                    <button type=" button" class="btn btn-primary" id="search_btn"
                                    onclick="show_result()" value="Search"
                                    style="width: 300px; position: absolute; margin-top: 10px; margin-left: 20px;">Search</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="daftar_ecommerce"></div>
        <iframe id="table_result" data-src="" src="" name="iframe_target" width="1295px" height="500px"
            style="background:#ffffff">
        </iframe>
        <div id="tot_data">Total data: {{ total_data }}</div>
    </div>

    <div style="text-align: center;">-- Created by noobpro, 2022 --</div>
    <p></p>

    <script type="text/javascript">
        const iframe = document.getElementById("table_result");

        const table_result = document.getElementById("table_result");

        const key1 = document.getElementById("text_keyword1");
        const key2 = document.getElementById("text_keyword2");
        const key3 = document.getElementById("text_keyword3");
        const key4 = document.getElementById("text_keyword4");
        const total_minimal_keyword = 2;

        const keyword_list = [key1, key2, key3, key4];
        var keyword_value_list = []

        var ecommerce_list = [];
        const ecommerce_name_list = ['shopee', 'tokopedia', 'lazada', 'bukalapak', 'jd']

        function update_ecommerce_list(obj) {
            let checkbox_id = document.getElementById(obj.id);
            let brand_name = checkbox_id.value;
            let index = ecommerce_list.indexOf(brand_name);

            if (checkbox_id.checked) {
                // jika index < 0 berarti belum ada nama ecommerce di ecommerce_list, jadi masukkan ke dalam ecommerce_list
                if (index < 0)
                    ecommerce_list.push(brand_name);                
            }
            else {                
                // jika checkbox yang dipilih checked == false, maka hapus nama ecommerce yang ada di ecommerce_list jika ecommerce tersebut ada
                if (index > -1)
                    ecommerce_list.splice(index, 1);
            }  

            document.getElementById("daftar_ecommerce").innerHTML = ecommerce_list.toString() + " total: " + ecommerce_list.length.toString();
        }

        function is_keyword_ok() {
            keyword_value_list = []
            let result = false;

            let key_ok_count = 0;
            let empty_count = [];
            for (let i = 0; i < keyword_list.length; i++) {

                if (keyword_list[i].value.length >= 3) {
                    key_ok_count++;
                    keyword_value_list.push(keyword_list[i].value);
                }
                else {
                    // alert('empty found!')
                    empty_count.push(i);
                }
            }

            if (key_ok_count < total_minimal_keyword)
                alert('Masukkan minimal 2 keyword (tiap keyword min 3 karakter)!');
            else { // 2 keyword sudah diisi dengan benar, tetapi harus cek lagi jumlah keyword yang kosong

                // jika jumlah empty_count > 0, berarti ada keyword yang jumlah karakternya < 3.
                // cek apakah keyword tersebut kosong atau terisi tetapi < 3, jika < 3 maka beri peringatan, jika kosong
                // berarti keyword tersebut tidak digunakan
                if (empty_count.length > 0) {

                    key_ok_count = 0;
                    for (let i = 0; i < empty_count.length; i++) {

                        if (keyword_list[empty_count[i]].value.length > 0 && keyword_list[empty_count[i]].value.length < 3) {
                            alert('Keyword ' + (empty_count[i] + 1).toString() + ' minimal 3 karakter!');
                            result = false;
                        }
                        else
                            key_ok_count++;
                    }

                    if (empty_count.length == key_ok_count) result = true;
                }
                else
                    result = true;
            }

            return result;
        }

        function ecommerce_link() {
            let result = "";

            if (ecommerce_list.length <= 0) 
                alert("Silahkan pilih e-commerce [minimal satu]!"); 
            else {
                // ubah format daftar ecommerce misal yang asalnya seperti ini: shopee,tokopedia menjadi shopee&tokopedia (replace char koma dengan char &)
                result = ecommerce_list.toString();
                result = result.replace(",", "&");
            }
            
            return result;
        }

        function set_each_keyword(key, no_urut) {
            return "keyword" + no_urut + "=" + key + "&";
        }

        function show_result() {

            if (is_keyword_ok() && ecommerce_link() != "") {
                let final_keyword = keyword_value_list.toString();

                // gabung beberapa keyword menjadi satu
                final_keyword = "ecommerce=" + ecommerce_link() + "&"  + set_each_keyword(key1.value, 1) + set_each_keyword(key2.value, 2) + set_each_keyword(key3.value, 3) + set_each_keyword(key4.value, 4);
             
                table_result.src = "table_result.html";

                // membuka tab baru tetapi dibuka di iframe, info tambahan: https://stackoverflow.com/questions/15198972/javascript-location-replace-and-iframe
                window.open("/search?" + final_keyword, "iframe_target");
                
            }
            else {
                table_result.src = "empty_result.html";
            }
        }

        window.onload = onLoadPage();

        function onLoadPage() {
            update_ecommerce_list(document.getElementById("shopee_check"));
        }

    </script>
</body>

</html>
